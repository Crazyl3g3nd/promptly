/*
 * File:        FixedHeader.js
 * Version:     2.0.6
 * Description: "Fix" a header at the top of the table, so it scrolls with the table
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Created:     Wed 16 Sep 2009 19:46:30 BST
 * Language:    Javascript
 * License:     GPL v2 or BSD 3 point style
 * Project:     Just a little bit of fun - enjoy :-)
 * Contact:     www.sprymedia.co.uk/contact
 *
 * Copyright 2009-2012 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 */
/*
 * Function: FixedHeader
 * Purpose:  Provide 'fixed' header, footer and columns on an HTML table
 * Returns:  object:FixedHeader - must be called with 'new'
 * Inputs:   mixed:mTable - target table
 *					   1. DataTable object - when using FixedHeader with DataTables, or
 *					   2. HTML table node - when using FixedHeader without DataTables
 *           object:oInit - initialisation settings, with the following properties (each optional)
 *             bool:top -    fix the header (default true)
 *             bool:bottom - fix the footer (default false)
 *             bool:left -   fix the left most column (default false)
 *             bool:right -  fix the right most column (default false)
 *             int:zTop -    fixed header zIndex
 *             int:zBottom - fixed footer zIndex
 *             int:zLeft -   fixed left zIndex
 *             int:zRight -  fixed right zIndex
 */
var FixedHeader=function(a,b){if(typeof this.fnInit!="function"){alert("FixedHeader warning: FixedHeader must be initialised with the 'new' keyword.");return}var c=this,d={aoCache:[],oSides:{top:!0,bottom:!1,left:!1,right:!1},oZIndexes:{top:104,bottom:103,left:102,right:101},oMes:{iTableWidth:0,iTableHeight:0,iTableLeft:0,iTableRight:0,iTableTop:0,iTableBottom:0},oOffset:{top:0},nTable:null,bUseAbsPos:!1,bFooter:!1};this.fnGetSettings=function(){return d},this.fnUpdate=function(){this._fnUpdateClones(),this._fnUpdatePositions()},this.fnPosition=function(){this._fnUpdatePositions()},this.fnInit(a,b),typeof a.fnSettings=="function"&&(a._oPluginFixedHeader=this)};FixedHeader.prototype={fnInit:function(a,b){var c=this.fnGetSettings(),d=this;this.fnInitSettings(c,b);if(typeof a.fnSettings=="function"){if(typeof a.fnVersionCheck=="functon"&&a.fnVersionCheck("1.6.0")!==!0){alert("FixedHeader 2 required DataTables 1.6.0 or later. Please upgrade your DataTables installation");return}var e=a.fnSettings();if(e.oScroll.sX!=""||e.oScroll.sY!=""){alert("FixedHeader 2 is not supported with DataTables' scrolling mode at this time");return}c.nTable=e.nTable,e.aoDrawCallback.push({fn:function(){FixedHeader.fnMeasure(),d._fnUpdateClones.call(d),d._fnUpdatePositions.call(d)},sName:"FixedHeader"})}else c.nTable=a;c.bFooter=$(">tfoot",c.nTable).length>0?!0:!1,c.bUseAbsPos=jQuery.browser.msie&&(jQuery.browser.version=="6.0"||jQuery.browser.version=="7.0"),c.oSides.top&&c.aoCache.push(d._fnCloneTable("fixedHeader","FixedHeader_Header",d._fnCloneThead)),c.oSides.bottom&&c.aoCache.push(d._fnCloneTable("fixedFooter","FixedHeader_Footer",d._fnCloneTfoot)),c.oSides.left&&c.aoCache.push(d._fnCloneTable("fixedLeft","FixedHeader_Left",d._fnCloneTLeft)),c.oSides.right&&c.aoCache.push(d._fnCloneTable("fixedRight","FixedHeader_Right",d._fnCloneTRight)),FixedHeader.afnScroll.push(function(){d._fnUpdatePositions.call(d)}),jQuery(window).resize(function(){FixedHeader.fnMeasure(),d._fnUpdateClones.call(d),d._fnUpdatePositions.call(d)}),FixedHeader.fnMeasure(),d._fnUpdateClones(),d._fnUpdatePositions()},fnInitSettings:function(a,b){typeof b!="undefined"&&(typeof b.top!="undefined"&&(a.oSides.top=b.top),typeof b.bottom!="undefined"&&(a.oSides.bottom=b.bottom),typeof b.left!="undefined"&&(a.oSides.left=b.left),typeof b.right!="undefined"&&(a.oSides.right=b.right),typeof b.zTop!="undefined"&&(a.oZIndexes.top=b.zTop),typeof b.zBottom!="undefined"&&(a.oZIndexes.bottom=b.zBottom),typeof b.zLeft!="undefined"&&(a.oZIndexes.left=b.zLeft),typeof b.zRight!="undefined"&&(a.oZIndexes.right=b.zRight),typeof b.offsetTop!="undefined"&&(a.oOffset.top=b.offsetTop)),a.bUseAbsPos=jQuery.browser.msie&&(jQuery.browser.version=="6.0"||jQuery.browser.version=="7.0")},_fnCloneTable:function(a,b,c){var d=this.fnGetSettings(),e;jQuery(d.nTable.parentNode).css("position")!="absolute"&&(d.nTable.parentNode.style.position="relative"),e=d.nTable.cloneNode(!1),e.removeAttribute("id");var f=document.createElement("div");return f.style.position="absolute",f.style.top="0px",f.style.left="0px",f.className+=" FixedHeader_Cloned "+a+" "+b,a=="fixedHeader"&&(f.style.zIndex=d.oZIndexes.top),a=="fixedFooter"&&(f.style.zIndex=d.oZIndexes.bottom),a=="fixedLeft"?f.style.zIndex=d.oZIndexes.left:a=="fixedRight"&&(f.style.zIndex=d.oZIndexes.right),e.style.margin="0",f.appendChild(e),document.body.appendChild(f),{nNode:e,nWrapper:f,sType:a,sPosition:"",sTop:"",sLeft:"",fnClone:c}},_fnMeasure:function(){var a=this.fnGetSettings(),b=a.oMes,c=jQuery(a.nTable),d=c.offset(),e=this._fnSumScroll(a.nTable.parentNode,"scrollTop"),f=this._fnSumScroll(a.nTable.parentNode,"scrollLeft");b.iTableWidth=c.outerWidth(),b.iTableHeight=c.outerHeight(),b.iTableLeft=d.left+a.nTable.parentNode.scrollLeft,b.iTableTop=d.top+e,b.iTableRight=b.iTableLeft+b.iTableWidth,b.iTableRight=FixedHeader.oDoc.iWidth-b.iTableLeft-b.iTableWidth,b.iTableBottom=FixedHeader.oDoc.iHeight-b.iTableTop-b.iTableHeight},_fnSumScroll:function(a,b){var c=a[b];while(a=a.parentNode){if(a.nodeName=="HTML"||a.nodeName=="BODY")break;c=a[b]}return c},_fnUpdatePositions:function(){var a=this.fnGetSettings();this._fnMeasure();for(var b=0,c=a.aoCache.length;b<c;b++)a.aoCache[b].sType=="fixedHeader"?this._fnScrollFixedHeader(a.aoCache[b]):a.aoCache[b].sType=="fixedFooter"?this._fnScrollFixedFooter(a.aoCache[b]):a.aoCache[b].sType=="fixedLeft"?this._fnScrollHorizontalLeft(a.aoCache[b]):this._fnScrollHorizontalRight(a.aoCache[b])},_fnUpdateClones:function(){var a=this.fnGetSettings();for(var b=0,c=a.aoCache.length;b<c;b++)a.aoCache[b].fnClone.call(this,a.aoCache[b])},_fnScrollHorizontalRight:function(a){var b=this.fnGetSettings(),c=b.oMes,d=FixedHeader.oWin,e=FixedHeader.oDoc,f=a.nWrapper,g=jQuery(f).outerWidth();d.iScrollRight<c.iTableRight?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+c.iTableWidth-g+"px","left",f.style)):c.iTableLeft<e.iWidth-d.iScrollRight-g?b.bUseAbsPos?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",e.iWidth-d.iScrollRight-g+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","fixed","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop-d.iScrollTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",d.iWidth-g+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style))},_fnScrollHorizontalLeft:function(a){var b=this.fnGetSettings(),c=b.oMes,d=FixedHeader.oWin,e=FixedHeader.oDoc,f=a.nWrapper,g=jQuery(f).outerWidth();d.iScrollLeft<c.iTableLeft?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):d.iScrollLeft<c.iTableLeft+c.iTableWidth-g?b.bUseAbsPos?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",d.iScrollLeft+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","fixed","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop-d.iScrollTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft","0px","left",f.style)):(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+c.iTableWidth-g+"px","left",f.style))},_fnScrollFixedFooter:function(a){var b=this.fnGetSettings(),c=b.oMes,d=FixedHeader.oWin,e=FixedHeader.oDoc,f=a.nWrapper,g=jQuery("thead",b.nTable).outerHeight(),h=jQuery(f).outerHeight();d.iScrollBottom<c.iTableBottom?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+c.iTableHeight-h+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):d.iScrollBottom<c.iTableBottom+c.iTableHeight-h-g?b.bUseAbsPos?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",e.iHeight-d.iScrollBottom-h+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","fixed","position",f.style),this._fnUpdateCache(a,"sTop",d.iHeight-h+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft-d.iScrollLeft+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+h+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style))},_fnScrollFixedHeader:function(a){var b=this.fnGetSettings(),c=b.oMes,d=FixedHeader.oWin,e=FixedHeader.oDoc,f=a.nWrapper,g=0,h=b.nTable.getElementsByTagName("tbody");for(var i=0;i<h.length;++i)g+=h[i].offsetHeight;c.iTableTop>d.iScrollTop+b.oOffset.top?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):d.iScrollTop+b.oOffset.top>c.iTableTop+g?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",c.iTableTop+g+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):b.bUseAbsPos?(this._fnUpdateCache(a,"sPosition","absolute","position",f.style),this._fnUpdateCache(a,"sTop",d.iScrollTop+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft+"px","left",f.style)):(this._fnUpdateCache(a,"sPosition","fixed","position",f.style),this._fnUpdateCache(a,"sTop",b.oOffset.top+"px","top",f.style),this._fnUpdateCache(a,"sLeft",c.iTableLeft-d.iScrollLeft+"px","left",f.style))},_fnUpdateCache:function(a,b,c,d,e){a[b]!=c&&(e[d]=c,a[b]=c)},_fnCloneThead:function(a){var b=this.fnGetSettings(),c=a.nNode;a.nWrapper.style.width=jQuery(b.nTable).outerWidth()+"px";while(c.childNodes.length>0)jQuery("thead th",c).unbind("click"),c.removeChild(c.childNodes[0]);var d=jQuery("thead",b.nTable).clone(!0)[0];c.appendChild(d),jQuery("thead>tr th",b.nTable).each(function(a){jQuery("thead>tr th:eq("+a+")",c).width(jQuery(this).width())}),jQuery("thead>tr td",b.nTable).each(function(a){jQuery("thead>tr td:eq("+a+")",c).width(jQuery(this).width())})},_fnCloneTfoot:function(a){var b=this.fnGetSettings(),c=a.nNode;a.nWrapper.style.width=jQuery(b.nTable).outerWidth()+"px";while(c.childNodes.length>0)c.removeChild(c.childNodes[0]);var d=jQuery("tfoot",b.nTable).clone(!0)[0];c.appendChild(d),jQuery("tfoot:eq(0)>tr th",b.nTable).each(function(a){jQuery("tfoot:eq(0)>tr th:eq("+a+")",c).width(jQuery(this).width())}),jQuery("tfoot:eq(0)>tr td",b.nTable).each(function(a){jQuery("tfoot:eq(0)>tr th:eq("+a+")",c)[0].style.width(jQuery(this).width())})},_fnCloneTLeft:function(a){var b=this.fnGetSettings(),c=a.nNode,d=$("tbody",b.nTable)[0],e=$("tbody tr:eq(0) td",b.nTable).length,f=$.browser.msie&&($.browser.version=="6.0"||$.browser.version=="7.0");while(c.childNodes.length>0)c.removeChild(c.childNodes[0]);c.appendChild(jQuery("thead",b.nTable).clone(!0)[0]),c.appendChild(jQuery("tbody",b.nTable).clone(!0)[0]),b.bFooter&&c.appendChild(jQuery("tfoot",b.nTable).clone(!0)[0]),$("thead tr",c).each(function(a){$("th:gt(0)",this).remove()}),$("tfoot tr",c).each(function(a){$("th:gt(0)",this).remove()}),$("tbody tr",c).each(function(a){$("td:gt(0)",this).remove()}),this.fnEqualiseHeights("tbody",d.parentNode,c);var g=jQuery("thead tr th:eq(0)",b.nTable).outerWidth();c.style.width=g+"px",a.nWrapper.style.width=g+"px"},_fnCloneTRight:function(a){var b=this.fnGetSettings(),c=$("tbody",b.nTable)[0],d=a.nNode,e=jQuery("tbody tr:eq(0) td",b.nTable).length,f=$.browser.msie&&($.browser.version=="6.0"||$.browser.version=="7.0");while(d.childNodes.length>0)d.removeChild(d.childNodes[0]);d.appendChild(jQuery("thead",b.nTable).clone(!0)[0]),d.appendChild(jQuery("tbody",b.nTable).clone(!0)[0]),b.bFooter&&d.appendChild(jQuery("tfoot",b.nTable).clone(!0)[0]),jQuery("thead tr th:not(:nth-child("+e+"n))",d).remove(),jQuery("tfoot tr th:not(:nth-child("+e+"n))",d).remove(),$("tbody tr",d).each(function(a){$("td:lt("+(e-1)+")",this).remove()}),this.fnEqualiseHeights("tbody",c.parentNode,d);var g=jQuery("thead tr th:eq("+(e-1)+")",b.nTable).outerWidth();d.style.width=g+"px",a.nWrapper.style.width=g+"px"},fnEqualiseHeights:function(a,b,c){var d=this,e=$(a+" tr:eq(0)",b).children(":eq(0)"),f=e.outerHeight()-e.height(),g=$.browser.msie&&($.browser.version=="6.0"||$.browser.version=="7.0");$(a+" tr",c).each(function(c){$.browser.mozilla||$.browser.opera?$(this).children().height($(a+" tr:eq("+c+")",b).outerHeight()):$(this).children().height($(a+" tr:eq("+c+")",b).outerHeight()-f),g||$(a+" tr:eq("+c+")",b).height($(a+" tr:eq("+c+")",b).outerHeight())})}},FixedHeader.oWin={iScrollTop:0,iScrollRight:0,iScrollBottom:0,iScrollLeft:0,iHeight:0,iWidth:0},FixedHeader.oDoc={iHeight:0,iWidth:0},FixedHeader.afnScroll=[],FixedHeader.fnMeasure=function(){var a=jQuery(window),b=jQuery(document),c=FixedHeader.oWin,d=FixedHeader.oDoc;d.iHeight=b.height(),d.iWidth=b.width(),c.iHeight=a.height(),c.iWidth=a.width(),c.iScrollTop=a.scrollTop(),c.iScrollLeft=a.scrollLeft(),c.iScrollRight=d.iWidth-c.iScrollLeft-c.iWidth,c.iScrollBottom=d.iHeight-c.iScrollTop-c.iHeight},FixedHeader.VERSION="2.0.6",FixedHeader.prototype.VERSION=FixedHeader.VERSION,jQuery(window).scroll(function(){FixedHeader.fnMeasure();for(var a=0,b=FixedHeader.afnScroll.length;a<b;a++)FixedHeader.afnScroll[a]()});